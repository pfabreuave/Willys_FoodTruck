const foodItem= [
    {
        id: 0,
        name: 'Haga su Pedido - Hay de todo',
        category : ' ',
        rating : 4.3,
        price: "",
        img: 'willyC.png',
        quantity: 1
    },
  {
      id: 1,
      name: '(P) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 26,
      img: 'images/frango/passar_Bat_p.jpg',
      quantity: 1
  },
  {
      id: 2,
      name: '(M) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 35,
      img: 'images/frango/passar_Bat_m.jpg',
      quantity: 1
  },
  {
      id: 3,
      name: '(G) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 50,
      img: 'images/frango/passar_Bat_p.jpg',
      quantity: 1
  },
  {
      id: 4,
      name: '(MEGA) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 60,
      img: 'images/frango/passar_Bat_Mega.jpg',
      quantity: 1
  },
  {
      id: 5,
      name: '(FAMILY) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 87,
      img: 'images/frango/passar_Bat_Mega.jpg',
      quantity: 1
  },
  {
      id: 6,
      name: '(FAMILY WILLYS) Passarinho + Batata',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 158,
      img: 'images/frango/passar_Bat_Mega.jpg',
      quantity: 1
  },
  {
      id: 7,
      name: '(P) Passarinho Solo, +- 6 pedaços',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 27,
      img: 'images/frango/passar_p.jpg',
      quantity: 1
  },
  {
      id: 8,
      name: '(M) Passarinho Solo, +- 10 pedaços',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 37,
      img: 'images/frango/passar_m.jpg',
      quantity: 1
  },
  {
      id: 9,
      name: '(G) Passarinho Solo, +- 14 pedaços',
      category : 'Frango Passarinho',
      rating : 4.3,
      price: 50,
      img: 'images/frango/passar_g.jpg',
      quantity: 1
  },
  {
      id: 10,
      name: '(P) File de Frango Empanado + Batata   ',
      category : 'Frango',
      rating : 4.3,
      price: 26,
      img: 'images/frango/emp_bat.jpg',
      quantity: 1
  },
  {
      id: 11,
      name: '(M) File de Frango Empanado + Batata   ',
      category : 'Frango',
      rating : 4.3,
      price: 35,
      img: 'images/frango/emp_bat.jpg',
      quantity: 1
  },
  {
      id: 12,
      name: '(G) File de Frango Empanado + Batata   ',
      category : 'Frango',
      rating : 4.3,
      price: 50,
      img: 'images/frango/emp_bat.jpg',
      quantity: 1
  },
  {
      id: 13,
      name: '(MEGA) File de Frango Empanado + Batata   ',
      category : 'Frango',
      rating : 4.3,
      price: 60,
      img: 'images/frango/emp_bat.jpg',
      quantity: 1
  },
  {
      id: 14,
      name: '(FAMILY) File de Frango Empanado + Batata   ',
      category : 'Frango',
      rating : 4.3,
      price: 87,
      img: 'images/frango/emp_bat.jpg',
      quantity: 1
  },
  {
      id: 15,
      name: '(P) File de Frango Empanado Solo, 250gr',
      category : 'Frango',
      rating : 4.3,
      price: 22,
      img: 'images/frango/file_empanado.jpg',
      quantity: 1
  },
  {
      id: 16,
      name: '(M) File de Frango Empanado Solo, 500gr',
      category : 'Frango',
      rating : 4.3,
      price: 37,
      img: 'images/frango/file_empanado.jpg',
      quantity: 1
  },
  {
      id: 17,
      name: '(G) File de Frango Empanado Solo, 1KG',
      category : 'Frango',
      rating : 4.3,
      price: 52,
      img: 'images/frango/file_empanado.jpg',
      quantity: 1
  },
  
  {
      id: 18,
      name: 'BACON',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 7,
      img: 'images/frango/bacon.jpg',
      quantity: 1
  },
  {
      id: 19,
      name: 'CALABRESA',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 7,
      img: 'images/frango/calabresa.jpg',
      quantity: 1
  },
  {
      id: 20,
      name: 'MUSSARELA',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 7,
      img: 'images/frango/mussarela.jpg',
      quantity: 1
  },
  {
      id: 21,
      name: 'CHEDDAR',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 7,
      img: 'images/frango/cheddar.jpg',
      quantity: 1
  },
  {
      id: 22,
      name: 'BATATA',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 15,
      img: 'images/frango/batata.jpg',
      quantity: 1
  },
  {
      id: 23,
      name: 'AIPIM',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 15,
      img: 'images/frango/aipim.jpg',
      quantity: 1
  },
  {
      id: 24,
      name: 'POLENTA',
      category : 'ADICIONAIS',
      rating : 4.3,
      price: 15,
      img: 'images/frango/polenta.jpg',
      quantity: 1
  },
  {
      id: 25,
      name: 'Completona de Casa',
      category : 'PORCOES',
      rating : 4.3,
      price: 65,
      img: 'images/frango/frango_variado.jpg',
      quantity: 1
  },
  {
      id: 26,
      name: 'Mista da Casa 1',
      category : 'PORCOES',
      rating : 4.3,
      price: 37,
      img: 'images/frango/frango_variado.jpg',
      quantity: 1
  },
  {
      id: 27,
      name: 'Mista da Casa 2',
      category : 'PORCOES',
      rating : 4.3,
      price: 50,
      img: 'images/frango/frango_variado.jpg',
      quantity: 1
  },
  {
      id: 28,
      name: 'Contra-file Grill PREMIUM 1',
      category : 'PORCOES',
      rating : 4.3,
      price: 62,
      img: 'images/frango/file_grill.png',
      quantity: 1
  },
  {
      id: 29,
      name: 'Contra-file Grill PREMIUM 2',
      category : 'PORCOES',
      rating : 4.3,
      price: 52,
      img: 'images/frango/file_grill.png',
      quantity: 1
  
  },
  {
      id: 30,
      name: 'Contra-file Grill Acebolado',
      category : 'PORCOES',
      rating : 4.3,
      price: 40,
      img: 'images/frango/file_grill.png',
      quantity: 1
  },
  {
      id: 31,
      name: 'Calabresa Acebolada',
      category : 'PORCOES',
      rating : 4.3,
      price: 23,
      img: 'images/frango/calabresa.jpg',
      quantity: 1
  
  },
  {
      id: 32,
      name: 'Fritas Cheddar & Bacon',
      category : 'PORCOES',
      rating : 4.3,
      price: 25,
      img: 'images/frango/papas-fritas-con-queso-cheddar.jpg',
      quantity: 1
  
  },
  {
      id: 33,
      name: 'Bolinho de Queijo (12 U)',
      category : 'PORCOES',
      rating : 4.3,
      price: 25,
      img: 'images/frango/bolinha-de-queijo.jpeg',
      quantity: 1
  },
  {
      id: 34,
      name: 'Porcao de Polenta(500gr)',
      category : 'PORCOES',
      rating : 4.3,
      price: 22,
      img: 'images/frango/polenta.jpg',
      quantity: 1
  },
  {
      id: 35,
      name: 'Porcao de Aipim(500gr)',
      category : 'PORCOES',
      rating : 4.3,
      price: 22,
      img: 'images/frango/aipim.jpg',
      quantity: 1
  },
  {
      id: 36,
      name: 'HAMBURGUER ESPECIAL',
      category : 'LANCHES',
      rating : 4.3,
      price: 12,
      img: 'images/hamburguer/hamburguer.jpg',
      quantity: 1
  },
  {
      id: 37,
      name: 'MISTO QUENTE',
      category : 'LANCHES',
      rating : 4.3,
      price: 11,
      img: 'images/hamburguer/misto_quente.jpg',
      quantity: 1
  },
  {
      id: 38,
      name: 'X-BURGER',
      category : 'LANCHES',
      rating : 4.3,
      price: 14,
      img: 'images/hamburguer/x-burguer.jpg',
      quantity: 1
  },
  {
      id: 38,
      name: 'X-EGG',
      category : 'LANCHES',
      rating : 4.3,
      price: 15,
      img: 'images/hamburguer/x-egg.jpg',
      quantity: 1
  },
  {
      id: 39,
      name: 'X-BACON',
      category : 'LANCHES',
      rating : 4.3,
      price: 16,
      img: 'images/hamburguer/x-bacon.jpg',
      quantity: 1
  },
  {
      id: 40,
      name: 'X-CALABRESA',
      category : 'LANCHES',
      rating : 4.3,
      price: 16,
      img: 'images/hamburguer/x-calabresa.jpg',
      quantity: 1
  },
  {
      id: 41,
      name: 'X-EGG CALABRESA',
      category : 'LANCHES',
      rating : 4.3,
      price: 18,
      img: 'images/hamburguer/x-egg-calabresa.jpg',
      quantity: 1
  },
  {
      id: 42,
      name: 'X-TUDO',
      category : 'LANCHES',
      rating : 4.3,
      price: 20,
      img: 'images/hamburguer/x-tudo.jpg',
      quantity: 1
  },
  {
      id: 43,
      name: 'X-TUDO DUPLO',
      category : 'LANCHES',
      rating : 4.3,
      price: 26,
      img: 'images/hamburguer/x-tudo.jpg',
      quantity: 1
  },
  {
      id: 44,
      name: 'X-FRANGO',
      category : 'LANCHES',
      rating : 4.3,
      price: 16,
      img: 'images/hamburguer/x-frango.jpg',
      quantity: 1
  },
  {
      id: 45,
      name: 'X-EGG FRANGO',
      category : 'LANCHES',
      rating : 4.3,
      price: 17,
      img: 'images/hamburguer/x-egg-frango.png',
      quantity: 1
  },
  {
      id: 46,
      name: 'X-EGG FRANGO ESPECIAL',
      category : 'LANCHES',
      rating : 4.3,
      price: 19,
      img: 'images/hamburguer/x-egg-frango-esp.jpg',
      quantity: 1
  },
  {
      id: 47,
      name: 'WILLYS TRIPLO FRIES',
      category : 'LANCHES',
      rating : 4.3,
      price: 35,
      img: 'images/frango/Contra-file.jpg',
      quantity: 1
  },
  {
      id: 48,
      name: 'X-CONTRA-FILE',
      category : 'LANCHES',
      rating : 4.3,
      price: 23,
      img: 'images/frango/Contra-file.jpg',
      quantity: 1
  },
  {
      id: 49,
      name: 'X-TUDO CONTRA-FILE',
      category : 'LANCHES',
      rating : 4.3,
      price: 28,
      img: 'images/frango/Contra-file.jpg',
      quantity: 1
  },
  {
      id: 50,
      name: 'COCA/SABORES LATA',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 6,
      img: 'images/bebidas/COCA-SABORES-LATA.jpg',
      quantity: 1
  },
  {
      id: 51,
      name: 'COCA/SABORES 600ML',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 8,
      img: 'images/bebidas/COCA-SABORES-LATA.jpg',
      quantity: 1
  },
  {
      id: 52,
      name: 'COCA-COLA/SABORES 1,5LT',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 11,
      img: 'images/bebidas/coca-cola-1-5l.jpg',
      quantity: 1
  },
  {
      id: 53,
      name: 'COCA-COLA/SABORES 2LT',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 13,
      img: 'images/bebidas/coca_cola_2l.jpg',
      quantity: 1
  },
  {
      id: 54,
      name: 'AGUA NATURAL',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 3,
      img: 'images/bebidas/agua-natural.jpg',
      quantity: 1
  },
  {
      id: 55,
      name: 'AGUA COM GAS',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 4,
      img: 'images/bebidas/agua-com-gas.jpg',
      quantity: 1
  },
  {
      id: 56,
      name: 'CERVEJA BRAHMA LATAO',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 8,
      img: 'images/bebidas/cerveja-brahma-latao.jpg',
      quantity: 1
  },
  {
      id: 57,
      name: 'CERVEJA DEVASSA LATAO',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 8,
      img: 'images/bebidas/devassa-latao.jpg',
      quantity: 1
  },
  {
      id: 58,
      name: 'CERVEJA BRAHMA LONG NECK',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 8,
      img: 'images/bebidas/brahma-long-neck.jpg',
      quantity: 1
  },
  {
      id: 59,
      name: 'CERVEJA BUDWEISER LOG NECK',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 10,
      img: 'images/bebidas/budweiser-log-neck.jpg',
      quantity: 1
  },
  {
      id: 60,
      name: 'CERVEJA CORONA LONG NECK',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 12,
      img: 'images/bebidas/corona-long-neck.jpg',
      quantity: 1
  },
  {
      id: 61,
      name: 'CERVEJA HEINEKEIN LONG NECK',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 10,
      img: 'images/bebidas/Heinecken_LongNeck.png',
      quantity: 1
  },
  {
      id: 62,
      name: 'ENERGETICO MONSTER LATAO',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 16,
      img: 'images/bebidas/monster-energy.png',
      quantity: 1
  },
  {
      id: 63,
      name: 'ENERGETICO BUL LATAO',
      category : 'BEBIDAS',
      rating : 4.3,
      price: 20,
      img: 'images/bebidas/Energetitico-RedBull.jpg',
      quantity: 1
  },
]


var acumulador = 0;
var item_acumulador = 0;
var comandElement = document.getElementById("comand");
const btnClearStorage = document.querySelector("#btnClearStorage"); // botón para eliminar todos los registros
btnClearStorage.addEventListener("click", () => {
    // Llama a una función para eliminar los datos almacenados
    clearStorage();
  });
// Obtén una referencia al elemento con la clase "total" en tu HTML
const totalElement = document.querySelector(".total");
const cantItemsElement = document.querySelector(".cantItems");

// Obtén una referencia al elemento select en tu HTML
const selectElement = document.getElementById("miSelect");
const comandaInput = document.getElementById("Comanda");

// Llena el select con opciones basadas en el array foodItem
for (let i = 0; i < foodItem.length; i++) {
  const option = document.createElement("option");
  option.value = foodItem[i].id; // Usar el id como el valor de la opción
  option.text = foodItem[i].name + ' ' + foodItem[i].price +'Rs'; // Usar el nombre como el texto de la opción
  selectElement.appendChild(option);
}

const selectedItemsTableBody = document.getElementById("selectedItemsTableBody");

// Consultar el Local Storage para obtener el último número de comanda
var lastComandaNumber = parseInt(localStorage.getItem("lastComanda")) || 0;

// Verificar si no hay ningún ítem cargado
if (lastComandaNumber === 0) {
  // Si no hay ningún pedido en el Local Storage, establecer el número de comanda inicial a 1
  lastComandaNumber = 1;
  localStorage.setItem("lastComanda", lastComandaNumber)
} else {
        // Si hay un pedido en el Local Storage, incrementar el número de comanda para la nueva comanda
        lastComandaNumber += 1;
        //localStorage.setItem("lastComanda", lastComandaNumber)
        totalElement.innerHTML = '';
        cantItemsElement.innerHTML = '';
        acumulador = 0;
        item_acumulador = 0;
    }

// Mostrar el número de comanda en el campo de input
comandElement.textContent = ("("+ lastComandaNumber + ")");
//comandaInput.value = lastComandaNumber;

// Manejar el evento change del elemento select
selectElement.addEventListener("change", function() {
  // Obtener el id del elemento seleccionado
  const selectedId = parseInt(selectElement.value);

  // Encontrar el objeto correspondiente en el array foodItem
  const selectedItem = foodItem.find(item => item.id === selectedId);

  // Obtén el valor de la comanda desde el input
  //const comanda = parseInt(comandaInput.value);
  const comanda = parseInt(lastComandaNumber);

  // Agrega la comanda al elemento seleccionado
  selectedItem.comanda = comanda;

  // Crear una nueva fila para el elemento seleccionado
  
  
  const newRow = document.createElement("tr");
  newRow.innerHTML = `
    <td><img src="${selectedItem.img}" alt="Imagen del artículo seleccionado" style="width: 50px; height: 50px;"></td>
    <td>${selectedItem.id}</td>
    <td>${selectedItem.name}</td>
    <td><input type="number" class="inputField cantidadInput" style="width:40px;"></td>
    <td>R$${selectedItem.price.toFixed(2)}</td>
    <td><button class="deleteButton" title="!-- Botón de eliminar --"><i class='bx bx-trash'></button></td> <!-- Botón de eliminar -->

  `;
  
  // Después de agregar la nueva fila a la tabla
  const cantidadInput = newRow.querySelector('.cantidadInput');
  
  cantidadInput.addEventListener('change', function() {
      const cantidad = parseInt(cantidadInput.value);
      const precioTotal = selectedItem.price * cantidad;
      // Actualizar el precio en la fila
      newRow.querySelector('td:nth-child(5)').textContent = `R$${precioTotal.toFixed(2)}`;

      acumulador = acumulador + precioTotal
      item_acumulador = item_acumulador + cantidad
      totalElement.innerHTML = acumulador.toFixed(2);
      cantItemsElement.innerHTML = item_acumulador;

      // Guardar el objeto en el localStorage
      saveToLocalStorage(selectedItem, cantidad, precioTotal);
  });
  
  
    
  // Agregar la nueva fila a la tabla
  selectedItemsTableBody.appendChild(newRow);

  // Guardar los pedidos en el Local Storage
  // Guardar el número de comanda actualizado en el Local Storage
  localStorage.setItem("lastComanda", lastComandaNumber);

  // ...

  // Manejar el evento de clic del botón de eliminar
  const deleteButton = newRow.querySelector(".deleteButton");
  deleteButton.addEventListener("click", function() {
    newRow.remove(); // Eliminar la fila al hacer clic en el botón

    // Obtener el ID del artículo a eliminar
    const itemId = selectedItem.id;

    acumulador = acumulador - selectedItem.precioTotal
    totalElement.innerHTML = acumulador.toFixed(2);
    item_acumulador = item_acumulador - selectedItem.cantidad
    cantItemsElement.innerHTML = item_acumulador;

    // Eliminar el artículo del Local Storage
    removeFromLocalStorage(itemId);
    

  });

  // Función para eliminar un artículo del Local Storage
  function removeFromLocalStorage(itemId) {
    console.log("entro a la funcion " + itemId)
    // Obtener los pedidos del Local Storage
    const orders = JSON.parse(localStorage.getItem("orders")) || [];

    // Encontrar el índice del artículo con el ID dado en el array de pedidos
    const index = orders.findIndex(item => item.id === itemId);

    // Si se encontró el artículo, eliminarlo del array de pedidos
    if (index !== -1) {
      orders.splice(index, 1);
    }

    // Guardar el array actualizado en el Local Storage
    localStorage.setItem("orders", JSON.stringify(orders));
  }

});

// Función para guardar en Local Storage
function saveToLocalStorage(item, cantidad, precioTotal) {
    // Obtén los pedidos existentes del Local Storage o crea un array vacío si no hay pedidos
    const orders = JSON.parse(localStorage.getItem("orders")) || [];
  
    // Agrega la cantidad y el precioTotal al objeto del pedido
    item.cantidad = cantidad;
    item.precioTotal = precioTotal;
  
    // Agrega el nuevo pedido al array
    orders.push(item);
  
    // Guarda el array actualizado en el Local Storage
    localStorage.setItem("orders", JSON.stringify(orders));
  }
  

// Obtén una referencia al botón "salvar" en tu HTML
const salvarButton = document.getElementById("btnCer");

// Agrega un evento de clic al botón "salvar"
salvarButton.addEventListener("click", function() {
  // Limpiar la tabla de productos seleccionados en la comanda
  selectedItemsTableBody.innerHTML = '';
  totalElement.innerHTML = '';
  cantItemsElement.innerHTML = '';
  acumulador = 0;
  item_acumulador = 0;

  // Aviso para el usuario de que la comanda actual ha sido cerrada y se puede comenzar una nueva
  // alert("Comanda ha sido salvada. Puedes comenzar una nueva comanda.");
  location.reload();  
});

/*
  Esta función primero muestra un cuadro de confirmación para asegurarse de que el usuario 
  realmente quiere eliminar todos los registros. Si el usuario confirma, borra los datos 
  almacenados en localStorage, limpia la tabla en la página, actualiza los totales a cero, 
  y limpia los campos de entrada y el arreglo items.

*/

function clearStorage() {
    if (confirm("¿Seguro deseas ELIMINAR todos los registros, no quiero LLORADERA?")) {
      // Borra los datos almacenados en localStorage
      localStorage.removeItem("orders");
      localStorage.removeItem("lastComanda");
      
      // Limpia la tabla en la página
      selectedItemsTableBody.innerHTML = '';
  
      // Actualiza los totales para reflejar que no hay registros
      acumulador = 0;
      item_acumulador = 0;
      lastComandaNumber = 0;
      totalElement.innerHTML = "";
      cantItemsElement.innerHTML = "";
      total.innerHTML = "0.00";
  
      // Limpia los campos de entrada
      Comanda.value = 0;
      //comandaInput.value = 0;
      numeroComanda = 0;
      location.reload();
  
    }
  }


